{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///home/nova/apps/tracking/src/app/users/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport Lottie from 'lottie-react';\nimport redCarAnimation from '../../../public/Red Car.json';\nimport greenTruckAnimation from '../../../public/Green Trucks.json';\n\ninterface Contract {\n  _id: string;\n  lot_number: string;\n  signature_data: string;\n  timestamp: string;\n  ip_address?: string;\n}\n\ninterface User {\n  phone_number: string;\n  full_name: string;\n  address: string;\n  contracts: Contract[];\n  contract_count: number;\n  first_contract: string;\n  last_contract: string;\n}\n\ninterface ApiResponse {\n  success: boolean;\n  users: User[];\n  total: number;\n  error?: string;\n}\n\nexport default function UsersPage() {\n  const [users, setUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [expandedUser, setExpandedUser] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  const fetchUsers = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/users');\n      const data: ApiResponse = await response.json();\n      \n      if (data.success) {\n        setUsers(data.users);\n      } else {\n        setError(data.error || 'Error al cargar usuarios');\n      }\n    } catch (err) {\n      setError('Error de conexión');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleUserExpansion = (phoneNumber: string) => {\n    setExpandedUser(expandedUser === phoneNumber ? null : phoneNumber);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('es-ES', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center py-12\">\n            <div className=\"animate-pulse\">\n              <div className=\"h-8 bg-gray-300 rounded w-48 mx-auto mb-4\"></div>\n              <div className=\"h-4 bg-gray-300 rounded w-32 mx-auto\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center py-12\">\n            <div className=\"text-red-600 text-lg\">{error}</div>\n            <button\n              onClick={fetchUsers}\n              className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\"\n            >\n              Reintentar\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-6xl mx-auto p-4\">\n        <div className=\"bg-white rounded-lg shadow-sm mb-6 p-6\">\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">Usuarios</h1>\n              <p className=\"text-gray-600 mt-1\">\n                Total: {users.length} usuarios con {users.reduce((sum, user) => sum + user.contract_count, 0)} contratos\n              </p>\n            </div>\n            <Link\n              href=\"/\"\n              className=\"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors\"\n            >\n              Inicio\n            </Link>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          {users.map((user) => (\n            <div key={user.phone_number} className=\"bg-white rounded-lg shadow-sm\">\n              <div \n                className=\"p-6 cursor-pointer hover:bg-gray-50 transition-colors\"\n                onClick={() => toggleUserExpansion(user.phone_number)}\n              >\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <h3 className=\"text-lg font-semibold text-gray-900\">\n                        {user.full_name || 'Sin nombre'}\n                      </h3>\n                      <span className=\"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full\">\n                        {user.contract_count} contrato{user.contract_count !== 1 ? 's' : ''}\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-gray-600 space-y-1\">\n                      <p><strong>Teléfono:</strong> {user.phone_number}</p>\n                      <p><strong>Dirección:</strong> {user.address || 'No especificada'}</p>\n                      <p><strong>Último contrato:</strong> {formatDate(user.last_contract)}</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center text-gray-400\">\n                    <svg \n                      className={`w-5 h-5 transition-transform ${expandedUser === user.phone_number ? 'rotate-180' : ''}`}\n                      fill=\"none\" \n                      stroke=\"currentColor\" \n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                    </svg>\n                  </div>\n                </div>\n              </div>\n\n              {expandedUser === user.phone_number && (\n                <div className=\"border-t border-gray-200 p-6\">\n                  <h4 className=\"text-md font-semibold text-gray-900 mb-4\">\n                    Contratos ({user.contracts.length})\n                  </h4>\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    {user.contracts.map((contract) => (\n                      <div key={contract._id} className=\"border border-gray-200 rounded-lg p-4\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <div>\n                            <p className=\"font-medium text-gray-900\">\n                              Lote: {contract.lot_number}\n                            </p>\n                            <p className=\"text-sm text-gray-600\">\n                              {formatDate(contract.timestamp)}\n                            </p>\n                          </div>\n                          <Link\n                            href={`/api/contracts/${contract._id}`}\n                            className=\"text-blue-600 hover:text-blue-800 text-sm font-medium\"\n                            target=\"_blank\"\n                          >\n                            Ver contrato\n                          </Link>\n                        </div>\n                        {contract.ip_address && (\n                          <p className=\"text-xs text-gray-500\">\n                            IP: {contract.ip_address}\n                          </p>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n\n          {users.length === 0 && (\n            <div className=\"text-center py-12\">\n              <div className=\"text-gray-500\">\n                <svg className=\"w-12 h-12 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n                <p className=\"text-lg\">No hay usuarios registrados</p>\n                <p className=\"text-sm mt-2\">Los usuarios aparecerán aquí cuando se registren contratos</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;;AAiCe,SAAS;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU,EAAE;IAC7C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAEhE,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG,EAAE;IAEL,MAAM,aAAa;QACjB,IAAI;YACF,WAAW;YACX,MAAM,WAAW,MAAM,MAAM;YAC7B,MAAM,OAAoB,MAAM,SAAS,IAAI;YAE7C,IAAI,KAAK,OAAO,EAAE;gBAChB,SAAS,KAAK,KAAK;YACrB,OAAO;gBACL,SAAS,KAAK,KAAK,IAAI;YACzB;QACF,EAAE,OAAO,KAAK;YACZ,SAAS;QACX,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,sBAAsB,CAAC;QAC3B,gBAAgB,iBAAiB,cAAc,OAAO;IACxD;IAEA,MAAM,aAAa,CAAC;QAClB,OAAO,IAAI,KAAK,YAAY,kBAAkB,CAAC,SAAS;YACtD,MAAM;YACN,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;QACV;IACF;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;;;;;0CACf,8OAAC;gCAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;IAM3B;IAEA,IAAI,OAAO;QACT,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCAAwB;;;;;;sCACvC,8OAAC;4BACC,SAAS;4BACT,WAAU;sCACX;;;;;;;;;;;;;;;;;;;;;;IAOX;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAmC;;;;;;kDACjD,8OAAC;wCAAE,WAAU;;4CAAqB;4CACxB,MAAM,MAAM;4CAAC;4CAAe,MAAM,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,cAAc,EAAE;4CAAG;;;;;;;;;;;;;0CAGlG,8OAAC,4JAAA,CAAA,UAAI;gCACH,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;;;;;;8BAML,8OAAC;oBAAI,WAAU;;wBACZ,MAAM,GAAG,CAAC,CAAC,qBACV,8OAAC;gCAA4B,WAAU;;kDACrC,8OAAC;wCACC,WAAU;wCACV,SAAS,IAAM,oBAAoB,KAAK,YAAY;kDAEpD,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;oEAAG,WAAU;8EACX,KAAK,SAAS,IAAI;;;;;;8EAErB,8OAAC;oEAAK,WAAU;;wEACb,KAAK,cAAc;wEAAC;wEAAU,KAAK,cAAc,KAAK,IAAI,MAAM;;;;;;;;;;;;;sEAGrE,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;;sFAAE,8OAAC;sFAAO;;;;;;wEAAkB;wEAAE,KAAK,YAAY;;;;;;;8EAChD,8OAAC;;sFAAE,8OAAC;sFAAO;;;;;;wEAAmB;wEAAE,KAAK,OAAO,IAAI;;;;;;;8EAChD,8OAAC;;sFAAE,8OAAC;sFAAO;;;;;;wEAAyB;wEAAE,WAAW,KAAK,aAAa;;;;;;;;;;;;;;;;;;;8DAGvE,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC;wDACC,WAAW,CAAC,6BAA6B,EAAE,iBAAiB,KAAK,YAAY,GAAG,eAAe,IAAI;wDACnG,MAAK;wDACL,QAAO;wDACP,SAAQ;kEAER,cAAA,8OAAC;4DAAK,eAAc;4DAAQ,gBAAe;4DAAQ,aAAa;4DAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;oCAM5E,iBAAiB,KAAK,YAAY,kBACjC,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAG,WAAU;;oDAA2C;oDAC3C,KAAK,SAAS,CAAC,MAAM;oDAAC;;;;;;;0DAEpC,8OAAC;gDAAI,WAAU;0DACZ,KAAK,SAAS,CAAC,GAAG,CAAC,CAAC,yBACnB,8OAAC;wDAAuB,WAAU;;0EAChC,8OAAC;gEAAI,WAAU;;kFACb,8OAAC;;0FACC,8OAAC;gFAAE,WAAU;;oFAA4B;oFAChC,SAAS,UAAU;;;;;;;0FAE5B,8OAAC;gFAAE,WAAU;0FACV,WAAW,SAAS,SAAS;;;;;;;;;;;;kFAGlC,8OAAC,4JAAA,CAAA,UAAI;wEACH,MAAM,CAAC,eAAe,EAAE,SAAS,GAAG,EAAE;wEACtC,WAAU;wEACV,QAAO;kFACR;;;;;;;;;;;;4DAIF,SAAS,UAAU,kBAClB,8OAAC;gEAAE,WAAU;;oEAAwB;oEAC9B,SAAS,UAAU;;;;;;;;uDApBpB,SAAS,GAAG;;;;;;;;;;;;;;;;;+BAzCtB,KAAK,YAAY;;;;;wBAwE5B,MAAM,MAAM,KAAK,mBAChB,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;wCAAyB,MAAK;wCAAO,QAAO;wCAAe,SAAQ;kDAChF,cAAA,8OAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAG,GAAE;;;;;;;;;;;kDAEvE,8OAAC;wCAAE,WAAU;kDAAU;;;;;;kDACvB,8OAAC;wCAAE,WAAU;kDAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ5C","debugId":null}}]
}