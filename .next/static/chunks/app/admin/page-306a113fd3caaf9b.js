(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{7220:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var a=t(5155),r=t(2115),l=t(6766),n=t(6874),i=t.n(n),o=t(3770),c=t.n(o),d=t(8336),m=t(3748);function x(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(!0),[o,x]=(0,r.useState)(null),[h,g]=(0,r.useState)(""),[u,b]=(0,r.useState)(""),[p,j]=(0,r.useState)(1),[v,f]=(0,r.useState)(0),[N,w]=(0,r.useState)(!1),[y,k]=(0,r.useState)(null),[C,L]=(0,r.useState)(null),S=(0,r.useRef)(p),E=(0,r.useRef)(h),D=(0,r.useRef)(u),M=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{let a=new URLSearchParams({page:e.toString(),limit:"20",search:t}),r=await fetch("/api/contracts?".concat(a)),l=await r.json();s(l.contracts||l),f(l.total||(l.contracts||l).length)}catch(e){console.error("Error loading contracts:",e)}finally{n(!1)}},[20]);(0,r.useEffect)(()=>{S.current=p},[p]),(0,r.useEffect)(()=>{E.current=h},[h]),(0,r.useEffect)(()=>{D.current=u},[u]),(0,r.useEffect)(()=>{M(p,h)},[p,h,M]),(0,r.useEffect)(()=>{let e=new EventSource("/api/contracts/stream");return e.onmessage=e=>{"new_contract"===JSON.parse(e.data).type&&M(S.current,E.current)},e.onerror=e=>{console.error("SSE connection error:",e)},()=>{e.close()}},[M]);let _=()=>{if(""!==u.trim()&&8!==u.trim().length)return void alert("El n\xfamero de lote debe tener exactamente 8 caracteres");g(u.trim().toUpperCase()),j(1)},z=Math.ceil(v/20),H=e=>{j(e)},A=async(e,s,t,a)=>{try{let r=await fetch("/api/contracts/".concat(e,"/signature")),l=await r.json();x({id:e,lotNumber:s,fullName:t,timestamp:a,signatureData:l.signatureData})}catch(e){console.error("Error loading signature:",e),alert("Error al cargar la firma")}},B=async()=>{if(y){w(!1),k(null);try{if((await fetch("/api/contracts/".concat(y.contractId),{method:"DELETE"})).ok)M(p,h);else throw Error("Error al eliminar")}catch(e){M(p,h)}}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:"w-full px-6 py-4",children:[(0,a.jsx)("div",{className:"bg-black rounded-3xl shadow-lg mb-8 overflow-hidden text-white",children:(0,a.jsxs)("div",{className:"px-12 py-8 text-center",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-3",children:"Jorge Minnesota Logistics LLC"}),(0,a.jsx)("p",{className:"text-gray-100 text-xl",children:"Registro de Contratos de Veh\xedculos"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-3xl p-8 border-l-4 border-black shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-5xl font-bold text-black mb-2",children:e.filter(e=>{let s=new Date(e.timestamp),t=new Date;return s.toDateString()===t.toDateString()}).length}),(0,a.jsx)("p",{className:"text-gray-600 text-lg font-medium",children:"Contratos Hoy"})]}),(0,a.jsx)("div",{className:"w-40 h-40 flex-shrink-0",children:(0,a.jsx)(c(),{animationData:d,loop:!0,autoplay:!0,style:{width:"100%",height:"100%"}})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-3xl p-8 border-l-4 border-black shadow-sm",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-5xl font-bold text-black mb-2",children:e.filter(e=>{let s=new Date(e.timestamp),t=new Date,a=new Date(t);return a.setDate(t.getDate()-t.getDay()),s>=a&&s<=t}).length}),(0,a.jsx)("p",{className:"text-gray-600 text-lg font-medium",children:"Esta Semana"})]})})}),(0,a.jsx)("div",{className:"bg-white rounded-3xl p-8 border-l-4 border-green-500 shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-5xl font-bold text-green-600 mb-2",children:v}),(0,a.jsx)("p",{className:"text-gray-600 text-lg font-medium",children:"Total Completados"})]}),(0,a.jsx)("div",{className:"w-40 h-40 flex-shrink-0",children:(0,a.jsx)(c(),{animationData:m,loop:!0,autoplay:!0,style:{width:"100%",height:"100%"}})})]})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"bg-black text-white p-4 rounded-t-2xl",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Lista de Contratos"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[(0,a.jsxs)(i(),{href:"/users",className:"px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})}),"Usuarios"]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",placeholder:"Buscar",value:u,onChange:e=>{let s=e.target.value.toUpperCase();s.length<=8&&b(s)},onKeyPress:e=>{"Enter"===e.key&&_()},className:"px-4 py-2 rounded-lg bg-white text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 text-sm w-48",maxLength:8})}),(0,a.jsxs)("button",{onClick:_,className:"px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar"]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium",children:"Actualizar"})]})]}),(0,a.jsxs)("div",{className:"text-sm opacity-90",children:["Mostrando ",e.length," de ",v," contratos",h&&(0,a.jsxs)("span",{children:[' • Filtrado por: "',h,'"']})]})]}),t?(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-100 text-center py-16",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 sm:h-12 sm:w-12 border-b-2 border-black mx-auto mb-4"}),(0,a.jsx)("span",{className:"text-sm sm:text-base text-gray-500",children:"Cargando contratos..."})]}):0===e.length?(0,a.jsx)("div",{className:"bg-white rounded-xl border border-gray-100 text-center py-16",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M5 11l1.5-4.5h11L19 11H5zm1.5 5c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.22.42-1.42 1.01L3 12v7c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-7l-2.08-5.99z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay contratos registrados"}),(0,a.jsx)("p",{className:"text-gray-500 mb-6",children:"Los contratos aparecer\xe1n aqu\xed cuando se registren en el sistema"})]})}):(0,a.jsxs)("div",{className:"bg-white rounded-b-2xl shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,a.jsxs)("div",{className:"grid grid-cols-14 gap-4 px-6 py-4 text-sm font-semibold text-gray-700",children:[(0,a.jsx)("div",{className:"col-span-1"}),(0,a.jsx)("div",{className:"col-span-2",children:"Tel\xe9fono"}),(0,a.jsx)("div",{className:"col-span-2",children:"Nombre"}),(0,a.jsx)("div",{className:"col-span-2",children:"Lote"}),(0,a.jsx)("div",{className:"col-span-2",children:"Gatepass"}),(0,a.jsx)("div",{className:"col-span-3",children:"Fecha y Hora"}),(0,a.jsx)("div",{className:"col-span-2",children:"Firma"})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:e.map((e,s)=>(0,a.jsx)("div",{className:"hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"grid grid-cols-14 gap-4 px-6 py-4 items-center",children:[(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0H4m16 0l-2-2m0 0l-2 2m2-2v-4M4 13l2-2m0 0l2 2m-2-2v-4"})})})}),(0,a.jsx)("div",{className:"col-span-2 text-sm text-gray-900",children:e.phone_number}),(0,a.jsx)("div",{className:"col-span-2 text-sm text-gray-900",children:e.full_name||"N/A"}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)("span",{className:"text-lg font-bold text-black font-mono",children:e.lot_number})}),(0,a.jsx)("div",{className:"col-span-2 text-sm text-gray-600",children:(0,a.jsx)("span",{className:"font-mono",children:e.gatepass||"N/A"})}),(0,a.jsxs)("div",{className:"col-span-3 text-sm text-gray-600",children:[new Date(e.timestamp).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short",year:"numeric"}).replace(/^\w/,e=>e.toUpperCase())," ",new Date(e.timestamp).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),(0,a.jsxs)("div",{className:"col-span-2 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>A(e.id,e.lot_number,e.full_name||"N/A",e.timestamp),className:"px-3 py-1.5 bg-black text-white text-sm rounded hover:bg-gray-800 transition-all transform hover:scale-105 active:scale-95 cursor-pointer shadow-sm hover:shadow-md",children:"Ver Firma"}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id.toString(),void(k({contractId:s,lotNumber:e.lot_number,fullName:e.full_name||"N/A"}),w(!0))},className:"p-1.5 text-black hover:bg-gray-50 rounded transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id))})]}),z>1&&(0,a.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsxs)("button",{onClick:()=>H(p-1),disabled:1===p,className:"px-3 py-2 rounded-xl text-sm transition-all duration-200 font-medium ".concat(1===p?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-black text-white hover:bg-gray-800 hover:shadow-md"),children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Anterior"}),(0,a.jsx)("span",{className:"sm:hidden",children:"←"})]}),(0,a.jsx)("div",{className:"flex gap-1 mx-2",children:Array.from({length:Math.min(3,z)},(e,s)=>{let t;if(z<=3)t=s+1;else{let e=Math.max(1,p-1),a=Math.min(z,e+2);if((t=e+s)>a)return null}return(0,a.jsx)("button",{onClick:()=>H(t),className:"px-3 py-2 rounded-xl text-sm min-w-[36px] transition-all duration-200 font-medium ".concat(p===t?"bg-black text-white shadow-md":"bg-white text-black border border-gray-200 hover:bg-gray-50 hover:shadow-sm"),children:t},t)})}),(0,a.jsxs)("button",{onClick:()=>H(p+1),disabled:p===z,className:"px-3 py-2 rounded-xl text-sm transition-all duration-200 font-medium ".concat(p===z?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-black text-white hover:bg-gray-800 hover:shadow-md"),children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Siguiente"}),(0,a.jsx)("span",{className:"sm:hidden",children:"→"})]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-2 sm:mt-0",children:["P\xe1gina ",p," de ",z]})]})]})]}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-2 sm:p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-4 sm:p-6 lg:p-8 max-w-2xl w-full mx-2 sm:mx-4 max-h-[95vh] sm:max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:[(0,a.jsx)("h3",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800",children:"Firma del Contrato"}),(0,a.jsx)("button",{onClick:()=>x(null),className:"w-8 h-8 sm:w-10 sm:h-10 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-gray-500 hover:text-gray-700 transition-all transform hover:scale-110 active:scale-95 cursor-pointer shadow-sm hover:shadow-md",children:(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-2 sm:space-y-3 lg:space-y-4 mb-4 sm:mb-6",children:[(0,a.jsxs)("p",{className:"text-sm sm:text-base break-words",children:[(0,a.jsx)("strong",{children:"Nombre:"})," ",(0,a.jsx)("span",{className:"text-black",children:o.fullName})]}),(0,a.jsxs)("p",{className:"text-sm sm:text-base break-all",children:[(0,a.jsx)("strong",{children:"Lote:"})," ",(0,a.jsx)("span",{className:"font-mono text-black",children:o.lotNumber})]}),(0,a.jsxs)("p",{className:"text-sm sm:text-base",children:[(0,a.jsx)("strong",{children:"Fecha:"})," ",new Date(o.timestamp).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})]})]}),(0,a.jsxs)("div",{className:"border border-gray-200 rounded-xl p-3 sm:p-4 bg-gray-50/30",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 mb-2 font-medium",children:"Firma Digital:"}),(0,a.jsx)("div",{className:"overflow-hidden rounded-xl bg-white border border-gray-100",children:(0,a.jsx)(l.default,{src:o.signatureData,alt:"Firma",className:"w-full max-w-full rounded-xl",style:{maxHeight:"300px",objectFit:"contain"},width:500,height:300})})]})]})}),N&&y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-100 max-w-md w-full mx-4 p-6 sm:p-8 text-center",children:[(0,a.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,a.jsx)("div",{className:"mx-auto w-12 h-12 sm:w-16 sm:h-16 bg-red-100 rounded-full flex items-center justify-center mb-3 sm:mb-4",children:(0,a.jsx)("svg",{className:"w-6 h-6 sm:w-8 sm:h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2",children:"Confirmar Eliminaci\xf3n"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-3 sm:mb-4 text-sm sm:text-base leading-relaxed",children:["\xbfEst\xe1 seguro de que desea eliminar el veh\xedculo del lote"," ",(0,a.jsx)("span",{className:"font-mono font-bold text-black",children:y.lotNumber})," ","de ",(0,a.jsx)("span",{className:"font-semibold text-black",children:y.fullName}),"?"]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-500",children:"Esta acci\xf3n no se puede deshacer."})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[(0,a.jsx)("button",{onClick:()=>{w(!1),k(null)},className:"flex-1 py-2.5 sm:py-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 hover:shadow-md transform hover:scale-105 active:scale-95 transition-all duration-200 text-sm sm:text-base cursor-pointer",children:"Cancelar"}),(0,a.jsx)("button",{onClick:B,className:"flex-1 py-2.5 sm:py-3 bg-black text-white font-semibold rounded-xl hover:bg-gray-800 hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 text-sm sm:text-base cursor-pointer",children:"Eliminar Veh\xedculo"})]})]})})]})}},7934:(e,s,t)=>{Promise.resolve().then(t.bind(t,7220))}},e=>{e.O(0,[66,766,647,875,441,964,358],()=>e(e.s=7934)),_N_E=e.O()}]);